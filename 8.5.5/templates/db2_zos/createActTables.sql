-- begin_generated_IBM_copyright_prolog

-- Licensed Materials - Property of IBM
-- 
-- 5724-N72 5655-WBS
-- 
-- Copyright IBM Corp. 2009 All Rights Reserved.
-- 
-- US Government Users Restricted Rights - Use, duplication or
-- disclosure restricted by GSA ADP Schedule Contract with
-- IBM Corp.

-- end_generated_IBM_copyright_prolog

-----------------------------------------------------------------------
-- WebSphere Service Registry and Repository
-- Create the WSRR Activity Logging Tables
-----------------------------------------------------------------------
SET CURRENT SCHEMA = '@ACT_DB_SCHEMA@' ;


-----------------------------------------------------------------------
-- DDL Statements for table SR_ACTIVITY_APICALL
-----------------------------------------------------------------------
CREATE TABLESPACE WSRRACT2
  IN @ACT_DB_NAME@
  USING
  STOGROUP @ACT_DB_STOGRP@
    PRIQTY -1
    SECQTY -1
  LOCKSIZE ROW
  CCSID UNICODE ;

CREATE TABLE @ACT_DB_SCHEMA@.SR_ACTIVITY_APICALL (
  ID INTEGER NOT NULL GENERATED BY DEFAULT
  AS IDENTITY(START WITH 1, INCREMENT BY 1),
  CONTAINER_ID INTEGER NOT NULL ,
  OWNING_APICALL_ID INTEGER,
  API_TYPE VARCHAR (8) ,
  METHOD VARCHAR (32) ,
  ROOT_OBJECT VARCHAR (72),
  USERID VARCHAR (64) ,
  TIME_CREATED TIMESTAMP NOT NULL)
  IN @ACT_DB_NAME@.WSRRACT2 ;

CREATE UNIQUE INDEX @ACT_DB_SCHEMA@.SR_ACTIVITY_APICALL_IDX
  ON @ACT_DB_SCHEMA@.SR_ACTIVITY_APICALL (
  ID)
  USING
  STOGROUP @ACT_DB_STOGRP@ 
  CLUSTER ;


CREATE INDEX @ACT_DB_SCHEMA@.IDX_ACT_APICALL_2 ON @ACT_DB_SCHEMA@.SR_ACTIVITY_APICALL(USERID, METHOD, ID) USING STOGROUP @ACT_DB_STOGRP@ ;
CREATE INDEX @ACT_DB_SCHEMA@.IDX_ACT_APICALL_3 ON @ACT_DB_SCHEMA@.SR_ACTIVITY_APICALL(METHOD, USERID, ID) USING STOGROUP @ACT_DB_STOGRP@ ;




ALTER TABLE @ACT_DB_SCHEMA@.SR_ACTIVITY_APICALL
  ADD PRIMARY KEY (ID) ;

-----------------------------------------------------------------------
-- DDL Statements for table SR_ACTIVITY_RECORD
-----------------------------------------------------------------------
CREATE TABLESPACE WSRRACT3
  IN @ACT_DB_NAME@
  USING
  STOGROUP @ACT_DB_STOGRP@
    PRIQTY -1
    SECQTY -1
  LOCKSIZE ROW
  CCSID UNICODE ;

CREATE TABLE @ACT_DB_SCHEMA@.SR_ACTIVITY_RECORD (
  ID INTEGER NOT NULL GENERATED BY DEFAULT
  AS IDENTITY(START WITH 1, INCREMENT BY 1),
  API_CALL_ID INTEGER NOT NULL,
  RESOURCE_ACTION VARCHAR (16) ,
  RESOURCE_TYPE VARCHAR (16) ,
  SUBJECT VARCHAR (72) ,
  PREDICATE VARCHAR (1020),
  FROM_VALUE VARCHAR (1020) ,
  TO_VALUE VARCHAR (1020) ,
  TIME_CREATED TIMESTAMP NOT NULL)
  IN @ACT_DB_NAME@.WSRRACT3 ;

CREATE UNIQUE INDEX @ACT_DB_SCHEMA@.SR_ACTIVITY_RECORD_IDX
  ON @ACT_DB_SCHEMA@.SR_ACTIVITY_RECORD (
  ID)
  USING
  STOGROUP @ACT_DB_STOGRP@ ;

ALTER TABLE @ACT_DB_SCHEMA@.SR_ACTIVITY_RECORD
  ADD PRIMARY KEY (ID) ;
  
CREATE INDEX @ACT_DB_SCHEMA@.IDX_ACT_REC_SUB
  ON @ACT_DB_SCHEMA@.SR_ACTIVITY_RECORD (
    SUBJECT,
    API_CALL_ID
  )
  USING
  STOGROUP @ACT_DB_STOGRP@ ;

CREATE INDEX @ACT_DB_SCHEMA@.IDX_ACT_REC_2
  ON @ACT_DB_SCHEMA@.SR_ACTIVITY_RECORD (
    RESOURCE_TYPE ASC,
    RESOURCE_ACTION ASC,
    TIME_CREATED ASC,
    TO_VALUE ASC,
    SUBJECT ASC,
    ID ASC,
    API_CALL_ID ASC)
  USING
  STOGROUP @ACT_DB_STOGRP@ ;
  
CREATE INDEX @ACT_DB_SCHEMA@.IDX_ACT_REC_3
  ON @ACT_DB_SCHEMA@.SR_ACTIVITY_RECORD (
    PREDICATE ASC,
    RESOURCE_ACTION ASC,
    RESOURCE_TYPE ASC,
    TIME_CREATED DESC,
    SUBJECT ASC,
    ID ASC,
    API_CALL_ID ASC)
  USING
  STOGROUP @ACT_DB_STOGRP@ ;

CREATE INDEX @ACT_DB_SCHEMA@.IDX_ACT_REC_4
  ON @ACT_DB_SCHEMA@.SR_ACTIVITY_RECORD (
    PREDICATE ASC,
    TIME_CREATED ASC,
    SUBJECT ASC,
    RESOURCE_TYPE ASC,
    RESOURCE_ACTION ASC,
    ID ASC,
    API_CALL_ID ASC)
  USING
  STOGROUP @ACT_DB_STOGRP@ ;
  
CREATE INDEX @ACT_DB_SCHEMA@.IDX_ACT_REC_5
  ON @ACT_DB_SCHEMA@.SR_ACTIVITY_RECORD (
    TIME_CREATED ASC,
    TO_VALUE ASC,
    SUBJECT ASC,
    RESOURCE_TYPE ASC,
    RESOURCE_ACTION ASC,
    ID ASC,
    API_CALL_ID ASC) 
  USING
  STOGROUP @ACT_DB_STOGRP@ ;


-----------------------------------------------------------------------
-- DDL Statements for grants
-----------------------------------------------------------------------
SET CURRENT RULES = 'STD' ;

GRANT SELECT,INSERT,UPDATE,DELETE,ALTER
  ON @ACT_DB_SCHEMA@.SR_ACTIVITY_APICALL
  TO @ACT_DB_USER@ ;
GRANT SELECT,INSERT,UPDATE,DELETE,ALTER
  ON @ACT_DB_SCHEMA@.SR_ACTIVITY_RECORD
  TO @ACT_DB_USER@ ;
  
SET CURRENT RULES = 'DB2' ;
