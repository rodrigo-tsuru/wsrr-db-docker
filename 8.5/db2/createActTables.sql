-- begin_generated_IBM_copyright_prolog

-- Licensed Materials - Property of IBM
-- 
-- 5724-N72 5655-WBS
-- 
-- Copyright IBM Corp. 2009 All Rights Reserved.
-- 
-- US Government Users Restricted Rights - Use, duplication or
-- disclosure restricted by GSA ADP Schedule Contract with
-- IBM Corp.

-- end_generated_IBM_copyright_prolog

SET CURRENT SCHEMA __DBSCHEMA__;

CREATE TABLE SR_ACTIVITY_APICALL (
    ID INTEGER NOT NULL GENERATED BY DEFAULT AS IDENTITY(START WITH 1,INCREMENT BY 1),
    CONTAINER_ID INTEGER NOT NULL ,
    OWNING_APICALL_ID INTEGER,
    API_TYPE VARCHAR (8) ,
    METHOD VARCHAR (32) ,
    ROOT_OBJECT VARCHAR (72),
    USERID VARCHAR (64) ,
    TIME_CREATED TIMESTAMP NOT NULL
) IN WSRRTS;

ALTER TABLE SR_ACTIVITY_APICALL ADD PRIMARY KEY (ID);

CREATE TABLE SR_ACTIVITY_RECORD (
    ID INTEGER NOT NULL GENERATED BY DEFAULT AS IDENTITY(START WITH 1,INCREMENT BY 1),
    API_CALL_ID INTEGER NOT NULL,
    RESOURCE_ACTION VARCHAR (16) ,
    RESOURCE_TYPE VARCHAR (16) ,
    SUBJECT VARCHAR (72) ,
    PREDICATE VARCHAR (1020),
    FROM_VALUE VARCHAR (1020) ,
    TO_VALUE VARCHAR (1020) ,
    TIME_CREATED TIMESTAMP NOT NULL
) IN WSRRTS;

ALTER TABLE SR_ACTIVITY_RECORD ADD PRIMARY KEY (ID);

CREATE INDEX IDX_ACT_REC_SUB ON SR_ACTIVITY_RECORD(SUBJECT, API_CALL_ID);

CREATE UNIQUE INDEX IDX_ACT_APICALL_1 ON SR_ACTIVITY_APICALL(ID ASC) INCLUDE(METHOD, USERID);
CREATE INDEX IDX_ACT_APICALL_2 ON SR_ACTIVITY_APICALL(USERID ASC, METHOD ASC, ID ASC);
CREATE INDEX IDX_ACT_APICALL_3 ON SR_ACTIVITY_APICALL(METHOD ASC, USERID ASC, ID ASC);
CREATE INDEX IDX_ACT_REC_2 ON SR_ACTIVITY_RECORD(RESOURCE_TYPE ASC, RESOURCE_ACTION ASC, TIME_CREATED ASC, TO_VALUE ASC, FROM_VALUE ASC, PREDICATE ASC, SUBJECT ASC, ID ASC, API_CALL_ID ASC);
CREATE INDEX IDX_ACT_REC_3 ON SR_ACTIVITY_RECORD(PREDICATE ASC, RESOURCE_ACTION ASC, RESOURCE_TYPE ASC, TIME_CREATED DESC, TO_VALUE ASC, FROM_VALUE ASC, SUBJECT ASC, ID ASC, API_CALL_ID ASC);
CREATE INDEX IDX_ACT_REC_4 ON SR_ACTIVITY_RECORD(PREDICATE ASC, TIME_CREATED ASC, TO_VALUE ASC, FROM_VALUE ASC, SUBJECT ASC, RESOURCE_TYPE ASC, RESOURCE_ACTION ASC, ID ASC, API_CALL_ID ASC);
CREATE INDEX IDX_ACT_REC_5 ON SR_ACTIVITY_RECORD(TIME_CREATED ASC, TO_VALUE ASC, FROM_VALUE ASC, PREDICATE ASC, SUBJECT ASC, RESOURCE_TYPE ASC, RESOURCE_ACTION ASC, ID ASC, API_CALL_ID ASC);

GRANT SELECT,INSERT,UPDATE,DELETE,ALTER ON SR_ACTIVITY_APICALL TO USER __DBUSER__;
GRANT SELECT,INSERT,UPDATE,DELETE,ALTER ON SR_ACTIVITY_RECORD TO USER __DBUSER__;
